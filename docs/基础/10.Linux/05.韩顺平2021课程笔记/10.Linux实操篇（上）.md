---
title: Linux实操篇（上）
date: 2022-04-11 13:38:58
permalink: /pages/4a5b75/
categories:
  - 基础
  - Linux
  - 韩顺平2021课程笔记
tags:
  - 
---
## 1. Vi 和 Vim 编辑器

要会一些基本的快捷键，一般在 Linux 下不需要特别复杂的操作。

::: tip 三种模式之间的相互切换

- 一般模式

- 编辑模式

- 命令模式

  :wq（保存退出） 

  :q（退出） 

  :q!（强制退出，不保存）

::: 

## 2. 开机、重启与用户登录注销

### 2.1 关机 & 重启命令

|             命令             |          说明                |
| :--------------------------: | ------------------------- |
|       shutdown -h now        | 立刻进行关机              |
|        shutdown -h 2         | “hello，2 分钟后会关机了” |
| `shutdown -r now` = `reboot` | 现在重启                  |
|             halt             | 关机，与上面一样          |
|             sync             | 把内存的数据同步到磁盘    |

- **不管是重启还是关机，首先要运行 sync 命令**，把内存中的数据写到磁盘中。目前的 shutdown/reboot/halt 等命令均在关机前进行了 sync，但小心驶得万年船。
- root 才可以关机。

### 2.2 用户登录与注销

**登录**时尽量少用 root 账号，避免操作失误。使用 `su <用户名>` 可以切换身份。

`logout` 命令即可**注销**用户。这个指令在图形运行级别无效。

## 3. 用户管理

Linux 是一个多用户多任务的操作系统。

### 3.1 添加用户

语法：`useradd 用户名`

- 当用户创建成功后，会**自动创建与用户同名的家目录**（`/home/用户名`）。
- 也可以通过 `useradd -d 指定目录 用户名` 来给新用户指定家目录。

### 3.2 指定/修改密码

`passwd tom`：给 tom 指定密码

**注：**若不指定用户名，则是修改当前用户的用户名。

### 3.3 删除用户

- `userdel nrich `：删除用户 nrich，但要保留家目录
- `userdel -r nrich`：删除用户及其家目录

一般情况下，我们**建议保留**，毕竟他所做的工作放在了里面。

### 3.4 查询用户信息

`id 用户名`：查询该用户的信息，当用户不存在时返回无此用户。

### 3.5 切换用户

当操作权限不够时，可以通过 `su` 命令切换到高权限用户。

- 从高权限到低权限的切换不需要密码，反之需要。
- 当需要返回到原来用户时，使用 `exit/logout` 指令。

### 3.6 查看当前登录用户

`whoami` = `who am I`：显示第一次登录时的用户。

> 此处自行尝试时，发现  `whoami` 显示的是当前切换过来的用户，`who am i` 显示的是第一次登陆时的用户。

### 3.7 用户组

类似于角色，用户组可以让系统对有共性/权限的多个用户进行统一管理。

- `groupadd 组名`：新增组
- `groupdel 组名`：删除组

如何将让一个用户加入一个组呢？有以下几种方法：

1. 增加用户时直接加上组：`useradd -g 用户组 用户名`
2. 修改用户的组：`usermod -g 用户组 用户名`
3. 若一个用户没有指定加入哪个组，会**默认在一个与自己同名的组**中

### 3.8 用户和组相关的文件

- /etc/passwd 文件：用户的配置文件，记录用户的各种信息

  - 每行的含义：`用户名:口令:用户标识号(uid):组标识号(gid):注释性描述:主目录(home中相应的目录):登录shell`

  - shell 的简单解释：可以把传给 Linux 内核的命令解析（直接把命令传给 Linux 内核是无法被解析的），如下图。我们常用的是 bash。

    ![image-20220417164321822](https://blog-1310567564.cos.ap-beijing.myqcloud.com/img/image-20220417164321822.png)

- /etc/shadow 文件：口令的配置文件

  - 每行的含义：`登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:失效时间:标志`

- /etc/group 文件：组的配置文件，记录各组的信息

  - 每行的含义：`组名:口令:组标识号:组内的用户列表`

## 4. 实用指令

### 4.1 运行级别

| 运行级别 | 说明                                   |
| :------: | -------------------------------------- |
|    0     | 关机                                   |
|    1     | 单用户模式（可以帮助我们找回丢失密码） |
|    2     | 多用户状态没有网络服务                 |
|    3     | 多用户状态**有网络服务**【工作中常用】 |
|    4     | 系统未使用，保留给用户                 |
|    5     | **图形界面**                           |
|    6     | 系统重启                               |

- 常见运行级别是 3 和 5，也可以指定默认运行级别。

`init <num>`：切换到 num 运行级别，如 `init 3` 将切换到多用户状态有网络服务模式（没有图形界面）。

#### CentOS 7 后运行级别说明

- **multi-user.target**：相当于 runlevel 3
- **graphical.target**：相当于 runlevel 5

查看当前默认运行级别：`systemctl get-default`

设置默认运行级别：`systemctl set-default TARGET.target`

> 当我们在图形化下将默认运行级别设为 multi-user.target 后，重启系统后会默认进入黑框框界面，即 runlevel 3。

### 4.2 找回 root 密码

// TODO

不同版本的系统找回密码具体操作有所区别。

### 4.3 帮助指令

- `man [命令或配置文件]`：获得帮助信息，比如 `man ls`
  - :smile:显示不全乎的按空格键继续往下走
  - 在 Linux 下， 隐藏文件是以 . 开头的
  - 选项可以组合使用，无顺序区别，比如 `ls -al` 或者 `ls -la`
  - `ls` 命令还可以指定一个目录，比如 `ls -l /root`

- `help 命令`：获得 shell 内置命令的帮助信息

如果英语不太好，**百度更直接**。

### 4.4 时间日期类

#### 4.4.1 date 显示当前日期

- date 显示时间：
  - `date`：显示当前日期
  - `date "+format"`：format 中可以用 %Y（年）、%m（月）、%d111（日）、%H（时）、%M（月）、%S（秒），比如 `date "+%Y-%m-%d %H:%M:%S"`

- date 设置时间： `date -s "2020-11-03 20:02:10"` ，时间为字符串格式

#### 4.4.2 cal 显示日历

calendar 的缩写。

```
cal [选项]
```

- 默认显示本月日历
- `cal 2020`：显示 2020 全年的日历

### 4.5 搜索查找类

#### 4.5.1 find

find 指令将从指定目录向下递归地遍历**其各个子目录**，将满足条件的文件或目录显示出来。

```
find [搜索范围] [选项]
```

- `-name <查询方式>`：按指定的文件名查找模式查找文件，也可以加匹配符 * 等。
- `-user <用户名>`：查找属于指定用户名的所有文件
- `-size <文件大小>`：按照指定的文件大小查找文件

> 案例：
>
> - 根据名称查找 /home 目录下的 hello.txt：`find /home -name hello.txt`
> - 查找 /opt 下用户 nrich 的文件：`find /opt -user nrich`
> - 查找整个 linux 系统下大于 200M 的文件(+n 大于， -n 小于，单位有 k, M, G)：`find / -size +200M` 

#### 4.5.2 locate

locate 可以快速定位文件路径。locate 指令**利用事先建立的数据库**实现快速定位，它**无需遍历整个**文件系统因而较快。为了保证查询结果准确性，**管理员必须定期更新** locate 时刻：`updatedb`。

`locate [搜索文件]`：

- 第一次使用前，必须使用 `updatedb` 指令来创建 locate 数据库。

#### 4.5.3 which

which 可以查看某个指令在哪个目录下。比如 `which ls` 查看 ls 指令在哪个目录。

#### 4.5.4 grep 指令和管道符号 `|`

grep 过滤查找。

管道夫 `|` 表示将前一个命令的处理结果输出传递给后面的命令处理。

```
grep [选项] 查找内容 源文件
```

- -n：显示匹配行及行号
- -i：忽略字母大小写

> 案例：在 hello.text 文件中查找“yes”所在行，并显示行号
>
> - 写法1：`cat /home/hello.txt | grep -n "yes"`
> - 写法2：`grep -n "yes" /home/hello.txt`

### 4.6 压缩和解压类

#### 4.6.1 gzip 压缩 & gunzip 解压

- `gzip 文件`：压缩文件为 *.gz 文件

  :pencil: 压缩的同时会把原文件删除！

- `gunzip 文件.gz`：解压

​			:pencil: 解压的同时也会把压缩文件删除

#### 4.6.2 zip 压缩 & unzip 解压

- `zip [选项] xxx.zip`：压缩文件和目录。`-r` 递归压缩，即压缩目录。
- `unzip [选项] xxx.zip`：解压缩文件。`-d <目录>` 指定解压后文件的存放目录。

> 案例：
>
> - 将 home 本身及 /home 下的所有文件压缩：`zip -r myhome.zip /home/`
> - 将 myhome.zip 解压到 /opt/tmp 目录下：`unzip -d /opt/tmp /home/myhome.zip`

#### 4.6.3 tar 打包 ⭐️

tar 是打包指令（仅仅打包但不压缩），最后打包后的文件是 xxx.tar.gz 文件。

`tar [选项] xxx.tar.gz 打包的内容`：打包目录，压缩后的文件格式为 xxx.tar.gz

- -c：【create】创建一个新的打包文件
- -v：【verbose】显示详细信息
- -f：【filename】指定压缩后的文件名
- -z：【gzip】打包同时用 gzip 算法压缩
- -x：【extract】**解包** .tar 文件

常用的选项组合：

- 打包并压缩：tar -**zcvf** xxx.tar.gz [原文件名/目录名]
- 解压并解包：tar -**zxvf** xxx.tar.gz [目的地]

> 案例：
>
> - 将 pig.txt 和 cat.txt 压缩成 pc.tar.gz：`tar -zcvf pc.tar.gz pig.txt cat.txt`
> - 将 /home 文件夹压缩成 myhome.tar.gz：`tar -zcvf myhome.tar.gz /home/`
> - 将 pc.tar.gz 解压到当前目录：`tar -zxvf pc.tar.gz`
> - 将 pc.tar.gz 解压到 /opt/tmp 目录：`tar -zxvf pc.tar.gz -C /opt/tmp`
